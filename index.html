<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GprinceDev RealTalk ‚Äî Say It Anonymously</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:#07070f;--bg-card:#0e0e1a;--bg-hover:#131325;--bg-compose:#0c0c1c;--bg-input:#090915;
      --border:rgba(255,255,255,.08);--border-hi:#a78bfa;
      --text:#f0eeff;--text-2:#9d9bba;--text-3:#4e4b6a;
      --r:10px;--rl:22px;--t:.22s cubic-bezier(.4,0,.2,1);
      --fd:'Syne',sans-serif;--fb:'DM Sans',sans-serif;
      --g-happy:linear-gradient(135deg,#f9d423,#ff4e50);
      --g-sad:linear-gradient(135deg,#4facfe,#00f2fe);
      --g-angry:linear-gradient(135deg,#f5515f,#9f041b);
      --g-love:linear-gradient(135deg,#f953c6,#b91d73);
      --g-naughty:linear-gradient(135deg,#a18cd1,#fbc2eb);
      --g-confession:linear-gradient(135deg,#f7971e,#ffd200);
      --g-rant:linear-gradient(135deg,#e52d27,#b31217);
      --g-advice:linear-gradient(135deg,#11998e,#38ef7d);
      --g-gratitude:linear-gradient(135deg,#00b4d8,#90e0ef);
      --g-random:linear-gradient(135deg,#7f7fd5,#86a8e7,#91eae4);
      --c-happy:#ffd166;--c-sad:#4facfe;--c-angry:#ff6b6b;--c-love:#f953c6;
      --c-naughty:#c084fc;--c-confession:#fb923c;--c-rant:#f87171;
      --c-advice:#34d399;--c-gratitude:#22d3ee;--c-random:#a5b4fc;
    }
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    html{scroll-behavior:smooth}
    body{background:var(--bg);color:var(--text);font-family:var(--fb);font-size:15px;line-height:1.6;min-height:100vh;overflow-x:hidden}
    ::-webkit-scrollbar{width:5px}
    ::-webkit-scrollbar-track{background:var(--bg)}
    ::-webkit-scrollbar-thumb{background:linear-gradient(#f953c6,#4facfe,#38ef7d);border-radius:3px}
    .container{max-width:720px;margin:0 auto;padding:0 18px}

    body::before{content:'';position:fixed;inset:0;z-index:0;pointer-events:none;
      background:radial-gradient(ellipse 60% 40% at 20% 10%,rgba(168,85,247,.18) 0%,transparent 60%),
        radial-gradient(ellipse 50% 35% at 80% 5%,rgba(79,172,254,.15) 0%,transparent 55%),
        radial-gradient(ellipse 55% 30% at 50% 90%,rgba(249,83,198,.12) 0%,transparent 60%),
        radial-gradient(ellipse 40% 25% at 90% 60%,rgba(56,239,125,.1) 0%,transparent 50%);
      animation:aurora 12s ease-in-out infinite alternate}
    @keyframes aurora{0%{transform:scale(1) rotate(0deg)}50%{transform:scale(1.05) rotate(1deg)}100%{transform:scale(1) rotate(-1deg)}}

    /* HEADER */
    .site-header{position:sticky;top:0;z-index:200;padding:0;background:rgba(7,7,15,.75);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border-bottom:1px solid rgba(255,255,255,.06)}
    .site-header::before{content:'';display:block;height:3px;background:linear-gradient(90deg,#f953c6,#a78bfa,#4facfe,#38ef7d,#ffd166,#f953c6);background-size:200% 100%;animation:rainbowSlide 4s linear infinite}
    @keyframes rainbowSlide{0%{background-position:0%}100%{background-position:200%}}
    .site-header .container{display:flex;align-items:center;justify-content:space-between;padding-top:12px;padding-bottom:12px}
    .brand{display:flex;align-items:center;gap:12px}
    .brand-logo{width:34px;height:34px;border-radius:10px;background:linear-gradient(135deg,#f953c6,#a78bfa,#4facfe);display:flex;align-items:center;justify-content:center;font-size:1.1rem;box-shadow:0 0 20px rgba(167,139,250,.4)}
    .brand-name{font-family:var(--fd);font-size:1.2rem;font-weight:800;letter-spacing:-.03em;background:linear-gradient(135deg,#f0eeff,#a78bfa);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .brand-sub{font-size:.65rem;color:var(--text-3);letter-spacing:.09em;text-transform:uppercase;padding:3px 9px;border:1px solid rgba(255,255,255,.08);border-radius:20px}
    @media(max-width:500px){.brand-sub{display:none}}
    .live-pill{display:flex;align-items:center;gap:7px;font-size:.68rem;color:var(--text-2);letter-spacing:.06em;text-transform:uppercase;background:rgba(56,239,125,.06);border:1px solid rgba(56,239,125,.15);padding:5px 12px;border-radius:20px}
    .pulse-dot{width:7px;height:7px;border-radius:50%;background:#38ef7d;box-shadow:0 0 10px #38ef7d;animation:pulse 2s ease-in-out infinite}
    @keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.35;transform:scale(.75)}}

    /* LOADING OVERLAY */
    .loading-overlay{
      position:fixed;inset:0;z-index:9999;
      background:var(--bg);
      display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px;
      transition:opacity .5s,visibility .5s;
    }
    .loading-overlay.hidden{opacity:0;visibility:hidden;pointer-events:none}
    .loading-logo{font-size:2.5rem;animation:bounceLogo 1s ease-in-out infinite alternate}
    @keyframes bounceLogo{from{transform:scale(1)}to{transform:scale(1.15)}}
    .loading-text{font-family:var(--fd);font-size:1.1rem;font-weight:700;background:linear-gradient(135deg,#f953c6,#a78bfa,#4facfe);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .loading-bar{width:180px;height:3px;background:rgba(255,255,255,.08);border-radius:3px;overflow:hidden}
    .loading-bar-fill{height:100%;width:30%;background:linear-gradient(90deg,#f953c6,#a78bfa,#4facfe);border-radius:3px;animation:loadSlide 1.2s ease-in-out infinite}
    @keyframes loadSlide{0%{transform:translateX(-100%)}100%{transform:translateX(500%)}}

    /* SETUP BANNER */
    .setup-banner{
      margin-bottom:20px;padding:16px 20px;
      background:linear-gradient(135deg,rgba(251,146,60,.12),rgba(249,83,198,.08));
      border:1px solid rgba(251,146,60,.3);border-radius:var(--rl);
      display:none;
    }
    .setup-banner.show{display:block}
    .setup-banner h3{font-family:var(--fd);font-size:.9rem;font-weight:700;color:#fb923c;margin-bottom:8px}
    .setup-banner p{font-size:.82rem;color:var(--text-2);line-height:1.6}
    .setup-banner code{background:rgba(255,255,255,.08);padding:2px 7px;border-radius:5px;font-size:.8rem;color:#a78bfa;font-family:monospace}
    .setup-banner ol{margin:8px 0 0 18px;font-size:.82rem;color:var(--text-2);line-height:1.8}
    .setup-banner a{color:#4facfe;text-decoration:none}
    .setup-banner a:hover{text-decoration:underline}

    main{padding-top:28px;padding-bottom:80px;position:relative;z-index:1}

    /* DAILY PROMPT */
    .daily-prompt{margin-bottom:26px;padding:20px 24px;background:linear-gradient(135deg,rgba(167,139,250,.12),rgba(79,172,254,.08));border:1px solid rgba(167,139,250,.25);border-radius:var(--rl);position:relative;overflow:hidden}
    .daily-prompt::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(167,139,250,.05),transparent);pointer-events:none}
    .daily-prompt::after{content:'‚ú¶';position:absolute;right:20px;top:12px;font-size:4rem;color:#a78bfa;opacity:.12;pointer-events:none;line-height:1}
    .prompt-eye{font-size:.63rem;font-family:var(--fd);font-weight:700;letter-spacing:.15em;text-transform:uppercase;background:linear-gradient(90deg,#a78bfa,#4facfe);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:7px;display:inline-block}
    .prompt-q{font-size:1.04rem;font-weight:500;color:var(--text);line-height:1.5}

    /* COMPOSE */
    .compose-wrap{margin-bottom:32px}
    .compose-card{background:var(--bg-compose);border:1px solid rgba(255,255,255,.07);border-radius:var(--rl);overflow:hidden;transition:border-color var(--t),box-shadow var(--t);position:relative}
    .compose-card::before{content:'';position:absolute;inset:0;border-radius:var(--rl);background:linear-gradient(135deg,rgba(249,83,198,.04),rgba(79,172,254,.04),rgba(56,239,125,.03));pointer-events:none}
    .compose-card:focus-within{border-color:rgba(167,139,250,.5);box-shadow:0 0 0 3px rgba(167,139,250,.12),0 8px 40px rgba(167,139,250,.1)}
    .compose-textarea{width:100%;min-height:112px;padding:20px 22px 12px;background:transparent;border:none;outline:none;color:var(--text);font-family:var(--fb);font-size:.97rem;line-height:1.7;resize:none;caret-color:#a78bfa;position:relative;z-index:1}
    .compose-textarea::placeholder{color:var(--text-3);font-style:italic;font-weight:300}

    /* NAME ROW */
    .name-row{display:flex;align-items:center;gap:10px;flex-wrap:wrap;padding:10px 18px 12px;border-top:1px solid rgba(255,255,255,.06);position:relative;z-index:1}
    .name-row-label{font-size:.63rem;font-family:var(--fd);font-weight:700;letter-spacing:.13em;text-transform:uppercase;color:var(--text-3);white-space:nowrap;flex-shrink:0}
    .name-input-wrap{display:flex;align-items:center;gap:8px;flex:1;min-width:170px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:20px;padding:6px 8px 6px 14px;transition:border-color var(--t),box-shadow var(--t)}
    .name-input-wrap:focus-within{border-color:rgba(167,139,250,.5);box-shadow:0 0 0 2px rgba(167,139,250,.12)}
    .name-icon{font-size:.85rem;opacity:.5;flex-shrink:0}
    .name-input{flex:1;background:transparent;border:none;outline:none;color:var(--text);font-family:var(--fb);font-size:.85rem;caret-color:#a78bfa;min-width:0}
    .name-input::placeholder{color:var(--text-3);font-style:italic}
    .btn-generate{display:flex;align-items:center;gap:5px;padding:6px 13px;background:linear-gradient(135deg,rgba(167,139,250,.15),rgba(79,172,254,.1));border:1px solid rgba(167,139,250,.2);border-radius:20px;color:#a78bfa;font-family:var(--fb);font-size:.74rem;cursor:pointer;transition:all var(--t);white-space:nowrap;flex-shrink:0}
    .btn-generate:hover{background:linear-gradient(135deg,rgba(167,139,250,.28),rgba(79,172,254,.2));box-shadow:0 0 16px rgba(167,139,250,.2)}
    .name-save-note{width:100%;font-size:.66rem;color:var(--text-3);font-style:italic;padding:0 2px;display:flex;align-items:center;gap:5px}
    .name-saved-badge{display:inline-flex;align-items:center;gap:4px;background:rgba(56,239,125,.12);color:#38ef7d;border-radius:10px;padding:1px 8px;font-size:.64rem;font-style:normal;opacity:0;transition:opacity .3s}
    .name-saved-badge.show{opacity:1}

    /* CATEGORY PICKER */
    .cat-picker{padding:10px 18px 13px;border-top:1px solid rgba(255,255,255,.06);display:flex;flex-direction:column;gap:10px;position:relative;z-index:1}
    .cat-label-row{display:flex;align-items:center;justify-content:space-between}
    .cat-label{font-size:.63rem;font-family:var(--fd);font-weight:700;letter-spacing:.13em;text-transform:uppercase;color:var(--text-3)}
    .cat-pills{display:flex;flex-wrap:wrap;gap:7px}
    .cat-pill{display:inline-flex;align-items:center;gap:5px;padding:6px 14px;border-radius:20px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.03);color:var(--text-2);font-family:var(--fb);font-size:.8rem;cursor:pointer;user-select:none;transition:all var(--t)}
    .cat-pill:hover{border-color:rgba(255,255,255,.18);color:var(--text);background:rgba(255,255,255,.07);transform:translateY(-1px)}
    .cat-pill.selected{color:#07070f;font-weight:700;border-color:transparent;box-shadow:0 4px 18px rgba(0,0,0,.3)}
    .cat-pill[data-cat="happy"].selected{background:var(--g-happy)}
    .cat-pill[data-cat="sad"].selected{background:var(--g-sad)}
    .cat-pill[data-cat="angry"].selected{background:var(--g-angry)}
    .cat-pill[data-cat="love"].selected{background:var(--g-love)}
    .cat-pill[data-cat="naughty"].selected{background:var(--g-naughty);color:#07070f}
    .cat-pill[data-cat="confession"].selected{background:var(--g-confession)}
    .cat-pill[data-cat="rant"].selected{background:var(--g-rant)}
    .cat-pill[data-cat="advice"].selected{background:var(--g-advice)}
    .cat-pill[data-cat="gratitude"].selected{background:var(--g-gratitude)}
    .cat-pill[data-cat="random"].selected{background:var(--g-random)}

    /* COMPOSE BAR */
    .compose-bar{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;padding:10px 18px 15px;border-top:1px solid rgba(255,255,255,.06);position:relative;z-index:1}
    .char-count{font-size:.72rem;color:var(--text-3);font-variant-numeric:tabular-nums;transition:color var(--t)}
    .char-count.warn{color:#ffd166}.char-count.danger{color:#ff6b6b}
    .btn-post{display:flex;align-items:center;gap:8px;padding:10px 26px;background:linear-gradient(135deg,#f953c6,#a78bfa,#4facfe);background-size:200% 100%;color:#fff;border:none;border-radius:var(--r);font-family:var(--fd);font-size:.88rem;font-weight:700;letter-spacing:.03em;cursor:pointer;transition:background-position .4s,transform var(--t),box-shadow var(--t);box-shadow:0 4px 20px rgba(167,139,250,.35)}
    .btn-post:hover{background-position:100% 0;transform:translateY(-2px);box-shadow:0 8px 30px rgba(167,139,250,.5)}
    .btn-post:active{transform:none;box-shadow:0 2px 10px rgba(167,139,250,.3)}
    .btn-post:disabled{opacity:.4;cursor:not-allowed;transform:none;box-shadow:none}
    @media(max-width:480px){.compose-bar{flex-direction:column;align-items:flex-start}.btn-post{width:100%;justify-content:center}}

    /* FILTER BAR */
    .filter-section{margin-bottom:24px}
    .filter-title{font-size:.62rem;font-family:var(--fd);font-weight:700;letter-spacing:.14em;text-transform:uppercase;color:var(--text-3);margin-bottom:10px}
    .filter-bar{display:flex;gap:7px;flex-wrap:wrap}
    .filter-pill{display:inline-flex;align-items:center;gap:5px;padding:6px 14px;border-radius:20px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.03);color:var(--text-3);font-family:var(--fb);font-size:.78rem;cursor:pointer;user-select:none;transition:all var(--t)}
    .filter-pill:hover{color:var(--text-2);border-color:rgba(255,255,255,.16);background:rgba(255,255,255,.06)}
    .filter-pill.active{color:#07070f;font-weight:700;border-color:transparent;box-shadow:0 3px 14px rgba(0,0,0,.25)}
    .filter-pill[data-filter="all"].active{background:linear-gradient(135deg,#f953c6,#a78bfa,#4facfe);box-shadow:0 4px 18px rgba(167,139,250,.35)}
    .filter-pill[data-filter="happy"].active{background:var(--g-happy)}
    .filter-pill[data-filter="sad"].active{background:var(--g-sad)}
    .filter-pill[data-filter="angry"].active{background:var(--g-angry)}
    .filter-pill[data-filter="love"].active{background:var(--g-love)}
    .filter-pill[data-filter="naughty"].active{background:var(--g-naughty)}
    .filter-pill[data-filter="confession"].active{background:var(--g-confession)}
    .filter-pill[data-filter="rant"].active{background:var(--g-rant)}
    .filter-pill[data-filter="advice"].active{background:var(--g-advice)}
    .filter-pill[data-filter="gratitude"].active{background:var(--g-gratitude)}
    .filter-pill[data-filter="random"].active{background:var(--g-random)}

    /* FEED HEADER */
    .feed-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    .feed-label{font-family:var(--fd);font-size:.72rem;font-weight:700;letter-spacing:.12em;text-transform:uppercase;background:linear-gradient(90deg,#a78bfa,#4facfe);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .sort-group{display:flex;gap:3px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:var(--r);padding:3px}
    .sort-btn{background:transparent;border:none;color:var(--text-3);font-family:var(--fb);font-size:.76rem;padding:5px 14px;border-radius:7px;cursor:pointer;transition:all var(--t)}
    .sort-btn.active{background:linear-gradient(135deg,rgba(167,139,250,.25),rgba(79,172,254,.15));color:var(--text);box-shadow:0 1px 6px rgba(0,0,0,.3)}
    .sort-btn:hover:not(.active){color:var(--text-2)}

    /* FEED */
    .feed{display:flex;flex-direction:column;gap:14px}
    .empty-state{text-align:center;padding:64px 20px;color:var(--text-3)}
    .empty-state.hidden{display:none}
    .empty-icon{font-size:3rem;margin-bottom:14px;opacity:.4}
    .empty-state p{font-size:.94rem;font-style:italic}

    /* POST CARD */
    .post-card{background:var(--bg-card);border:1px solid rgba(255,255,255,.07);border-radius:var(--rl);padding:20px 22px 15px;position:relative;overflow:hidden;animation:cardIn .38s cubic-bezier(.22,1,.36,1) both;transition:transform .26s cubic-bezier(.4,0,.2,1),box-shadow .26s,border-color var(--t)}
    @keyframes cardIn{from{opacity:0;transform:translateY(16px) scale(.97)}to{opacity:1;transform:translateY(0) scale(1)}}
    .post-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px}
    .post-card[data-cat="happy"]::before{background:var(--g-happy)}
    .post-card[data-cat="sad"]::before{background:var(--g-sad)}
    .post-card[data-cat="angry"]::before{background:var(--g-angry)}
    .post-card[data-cat="love"]::before{background:var(--g-love)}
    .post-card[data-cat="naughty"]::before{background:var(--g-naughty)}
    .post-card[data-cat="confession"]::before{background:var(--g-confession)}
    .post-card[data-cat="rant"]::before{background:var(--g-rant)}
    .post-card[data-cat="advice"]::before{background:var(--g-advice)}
    .post-card[data-cat="gratitude"]::before{background:var(--g-gratitude)}
    .post-card[data-cat="random"]::before{background:var(--g-random)}
    .post-card::after{content:'';position:absolute;inset:0;border-radius:var(--rl);opacity:0;transition:opacity .3s;pointer-events:none}
    .post-card[data-cat="happy"]::after{background:radial-gradient(ellipse at top left,rgba(249,212,35,.06),transparent 60%)}
    .post-card[data-cat="sad"]::after{background:radial-gradient(ellipse at top left,rgba(79,172,254,.06),transparent 60%)}
    .post-card[data-cat="angry"]::after{background:radial-gradient(ellipse at top left,rgba(245,81,95,.07),transparent 60%)}
    .post-card[data-cat="love"]::after{background:radial-gradient(ellipse at top left,rgba(249,83,198,.07),transparent 60%)}
    .post-card[data-cat="naughty"]::after{background:radial-gradient(ellipse at top left,rgba(192,132,252,.06),transparent 60%)}
    .post-card[data-cat="confession"]::after{background:radial-gradient(ellipse at top left,rgba(251,146,60,.06),transparent 60%)}
    .post-card[data-cat="rant"]::after{background:radial-gradient(ellipse at top left,rgba(248,113,113,.07),transparent 60%)}
    .post-card[data-cat="advice"]::after{background:radial-gradient(ellipse at top left,rgba(52,211,153,.06),transparent 60%)}
    .post-card[data-cat="gratitude"]::after{background:radial-gradient(ellipse at top left,rgba(34,211,238,.06),transparent 60%)}
    .post-card[data-cat="random"]::after{background:radial-gradient(ellipse at top left,rgba(165,180,252,.06),transparent 60%)}
    .post-card:hover{transform:translateY(-3px);border-color:rgba(255,255,255,.14)}
    .post-card:hover::after{opacity:1}
    .post-card[data-cat="happy"]:hover{box-shadow:0 8px 40px rgba(249,212,35,.12)}
    .post-card[data-cat="sad"]:hover{box-shadow:0 8px 40px rgba(79,172,254,.12)}
    .post-card[data-cat="angry"]:hover{box-shadow:0 8px 40px rgba(245,81,95,.12)}
    .post-card[data-cat="love"]:hover{box-shadow:0 8px 40px rgba(249,83,198,.14)}
    .post-card[data-cat="naughty"]:hover{box-shadow:0 8px 40px rgba(192,132,252,.13)}
    .post-card[data-cat="confession"]:hover{box-shadow:0 8px 40px rgba(251,146,60,.11)}
    .post-card[data-cat="rant"]:hover{box-shadow:0 8px 40px rgba(248,113,113,.13)}
    .post-card[data-cat="advice"]:hover{box-shadow:0 8px 40px rgba(52,211,153,.12)}
    .post-card[data-cat="gratitude"]:hover{box-shadow:0 8px 40px rgba(34,211,238,.12)}
    .post-card[data-cat="random"]:hover{box-shadow:0 8px 40px rgba(165,180,252,.12)}

    /* NEW badge for real-time posts */
    .new-badge{
      display:inline-flex;align-items:center;gap:4px;
      background:linear-gradient(135deg,#38ef7d,#4facfe);
      color:#07070f;font-size:.6rem;font-weight:800;font-family:var(--fd);
      padding:2px 8px;border-radius:10px;letter-spacing:.05em;text-transform:uppercase;
      animation:newPulse 2s ease-in-out 3;
    }
    @keyframes newPulse{0%,100%{box-shadow:0 0 0 0 rgba(56,239,125,.4)}50%{box-shadow:0 0 0 6px rgba(56,239,125,0)}}

    .card-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;flex-wrap:wrap;gap:7px;position:relative;z-index:1}
    .card-meta{display:flex;align-items:center;gap:9px;flex-wrap:wrap}
    .avatar{width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.6rem;font-weight:800;color:#fff;flex-shrink:0;text-shadow:0 1px 3px rgba(0,0,0,.4)}
    .avatar[data-cat="happy"]{background:var(--g-happy)}.avatar[data-cat="sad"]{background:var(--g-sad)}
    .avatar[data-cat="angry"]{background:var(--g-angry)}.avatar[data-cat="love"]{background:var(--g-love)}
    .avatar[data-cat="naughty"]{background:var(--g-naughty)}.avatar[data-cat="confession"]{background:var(--g-confession)}
    .avatar[data-cat="rant"]{background:var(--g-rant)}.avatar[data-cat="advice"]{background:var(--g-advice)}
    .avatar[data-cat="gratitude"]{background:var(--g-gratitude)}.avatar[data-cat="random"]{background:var(--g-random)}
    .card-alias{font-size:.82rem;font-weight:600;color:var(--text);letter-spacing:.01em}
    .card-alias-anon{font-size:.8rem;font-weight:400;color:var(--text-3);font-style:italic}
    .post-tag{display:inline-flex;align-items:center;gap:4px;font-size:.68rem;font-weight:700;letter-spacing:.02em;padding:3px 10px;border-radius:20px;border:1px solid rgba(255,255,255,.06)}
    .post-tag[data-cat="happy"]{background:rgba(249,212,35,.12);color:var(--c-happy)}
    .post-tag[data-cat="sad"]{background:rgba(79,172,254,.12);color:var(--c-sad)}
    .post-tag[data-cat="angry"]{background:rgba(245,81,95,.12);color:var(--c-angry)}
    .post-tag[data-cat="love"]{background:rgba(249,83,198,.12);color:var(--c-love)}
    .post-tag[data-cat="naughty"]{background:rgba(192,132,252,.12);color:var(--c-naughty)}
    .post-tag[data-cat="confession"]{background:rgba(251,146,60,.12);color:var(--c-confession)}
    .post-tag[data-cat="rant"]{background:rgba(248,113,113,.12);color:var(--c-rant)}
    .post-tag[data-cat="advice"]{background:rgba(52,211,153,.12);color:var(--c-advice)}
    .post-tag[data-cat="gratitude"]{background:rgba(34,211,238,.12);color:var(--c-gratitude)}
    .post-tag[data-cat="random"]{background:rgba(165,180,252,.12);color:var(--c-random)}
    .card-time{font-size:.68rem;color:var(--text-3);font-variant-numeric:tabular-nums}
    .card-body{font-size:.97rem;line-height:1.73;color:var(--text);word-break:break-word;margin-bottom:16px;position:relative;z-index:1}
    .card-reactions{display:flex;gap:8px;flex-wrap:wrap;padding-top:13px;border-top:1px solid rgba(255,255,255,.06);position:relative;z-index:1}
    .rxn-btn{display:flex;align-items:center;gap:6px;padding:6px 15px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.07);border-radius:20px;color:var(--text-3);font-family:var(--fb);font-size:.79rem;cursor:pointer;user-select:none;transition:all var(--t)}
    .rxn-btn:hover{border-color:rgba(255,255,255,.16);color:var(--text-2);background:rgba(255,255,255,.08);transform:translateY(-1px)}
    .rxn-btn.active-relate{background:rgba(249,83,198,.15);color:#f953c6;border-color:rgba(249,83,198,.3);box-shadow:0 0 12px rgba(249,83,198,.15)}
    .rxn-btn.active-support{background:rgba(79,172,254,.15);color:#4facfe;border-color:rgba(79,172,254,.3);box-shadow:0 0 12px rgba(79,172,254,.15)}
    .rxn-btn.active-fire{background:rgba(251,146,60,.15);color:#fb923c;border-color:rgba(251,146,60,.3);box-shadow:0 0 12px rgba(251,146,60,.15)}
    .rxn-icon{font-size:1rem}
    .rxn-count{font-variant-numeric:tabular-nums;font-weight:600;min-width:12px;text-align:center}
    @keyframes bump{0%{transform:scale(1)}45%{transform:scale(1.4)}100%{transform:scale(1)}}
    .bump{animation:bump .24s ease}

    /* TOAST */
    .toast{position:fixed;bottom:28px;left:50%;transform:translateX(-50%) translateY(14px);background:linear-gradient(135deg,rgba(167,139,250,.15),rgba(79,172,254,.1));backdrop-filter:blur(16px);border:1px solid rgba(167,139,250,.3);color:var(--text);padding:10px 24px;border-radius:20px;font-size:.84rem;opacity:0;pointer-events:none;white-space:nowrap;z-index:999;box-shadow:0 8px 32px rgba(0,0,0,.5);transition:opacity .22s,transform .22s}
    .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

    /* FOOTER */
    .site-footer{border-top:1px solid rgba(255,255,255,.05);padding:20px 0;text-align:center;position:relative;z-index:1}
    .site-footer p{font-size:.72rem;color:var(--text-3);letter-spacing:.04em}
    .site-footer span{background:linear-gradient(90deg,#f953c6,#a78bfa,#4facfe);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;font-weight:700}

    /* CONNECTION STATUS */
    .conn-status{
      display:inline-flex;align-items:center;gap:6px;
      font-size:.68rem;padding:4px 10px;border-radius:20px;
      transition:all .3s;
    }
    .conn-status.online{background:rgba(56,239,125,.08);border:1px solid rgba(56,239,125,.2);color:#38ef7d}
    .conn-status.offline{background:rgba(248,113,113,.08);border:1px solid rgba(248,113,113,.2);color:#f87171}
    .conn-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0}
    .conn-status.online .conn-dot{background:#38ef7d;box-shadow:0 0 6px #38ef7d}
    .conn-status.offline .conn-dot{background:#f87171}
  </style>
</head>
<body>

<!-- Loading overlay -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-logo">üí¨</div>
  <div class="loading-text">GprinceDev RealTalk</div>
  <div class="loading-bar"><div class="loading-bar-fill"></div></div>
</div>

<!-- HEADER -->
<header class="site-header">
  <div class="container">
    <div class="brand">
      <div class="brand-logo">üí¨</div>
      <h1 class="brand-name">GprinceDev RealTalk</h1>
      <span class="brand-sub">anonymous ¬∑ unfiltered</span>
    </div>
    <div style="display:flex;align-items:center;gap:10px">
      <span class="conn-status online" id="connStatus">
        <span class="conn-dot"></span>
        <span id="connText">live</span>
      </span>
    </div>
  </div>
</header>

<main class="container">

  <!-- Setup banner (shown if Firebase not configured) -->
  <div class="setup-banner" id="setupBanner">
    <h3>üîß One-time Firebase Setup Required</h3>
    <p>To share posts with all visitors in real-time, add your free Firebase config below. It only takes 2 minutes!</p>
    <ol>
      <li>Go to <a href="https://console.firebase.google.com" target="_blank">console.firebase.google.com</a> ‚Üí Create a project (free)</li>
      <li>Click <strong>Firestore Database</strong> ‚Üí Create database ‚Üí Start in <strong>test mode</strong></li>
      <li>Go to <strong>Project Settings</strong> ‚Üí Your apps ‚Üí Add web app ‚Üí Copy the config</li>
      <li>Replace the <code>FIREBASE_CONFIG</code> values in this file's script section</li>
    </ol>
    <p style="margin-top:8px">Until configured, posts are stored locally on your device only.</p>
  </div>

  <!-- Daily Prompt -->
  <section class="daily-prompt">
    <div class="prompt-eye">‚ú¶ Today's Prompt</div>
    <p class="prompt-q" id="promptText"></p>
  </section>

  <!-- Compose -->
  <section class="compose-wrap">
    <div class="compose-card">
      <textarea id="postInput" class="compose-textarea" maxlength="300"
        placeholder="Say it. No one knows it's you." aria-label="Write your anonymous post"></textarea>
      <div class="name-row">
        <span class="name-row-label">Your alias</span>
        <div class="name-input-wrap">
          <span class="name-icon">üë§</span>
          <input type="text" id="nameInput" class="name-input" maxlength="30"
            placeholder="e.g. SilentStorm, GhostWriter‚Ä¶" autocomplete="off" spellcheck="false"/>
        </div>
        <button class="btn-generate" id="btnGenName">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
          Random
        </button>
        <div class="name-save-note">Saved automatically &nbsp;<span class="name-saved-badge" id="nameSavedBadge">‚úì saved</span></div>
      </div>
      <div class="cat-picker">
        <div class="cat-label-row"><span class="cat-label">Pick a category</span></div>
        <div class="cat-pills" id="catPills">
          <button class="cat-pill selected" data-cat="happy">üéâ Happy</button>
          <button class="cat-pill" data-cat="sad">üòî Sad</button>
          <button class="cat-pill" data-cat="angry">üò° Angry</button>
          <button class="cat-pill" data-cat="love">üíñ Love</button>
          <button class="cat-pill" data-cat="naughty">üî• Naughty</button>
          <button class="cat-pill" data-cat="confession">ü§´ Confession</button>
          <button class="cat-pill" data-cat="rant">üí¢ Rant</button>
          <button class="cat-pill" data-cat="advice">üí° Advice</button>
          <button class="cat-pill" data-cat="gratitude">üôè Gratitude</button>
          <button class="cat-pill" data-cat="random">üé≤ Random</button>
        </div>
      </div>
      <div class="compose-bar">
        <span class="char-count" id="charCount">0 / 300</span>
        <button id="postBtn" class="btn-post">
          Post anonymously
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
        </button>
      </div>
    </div>
  </section>

  <!-- Filter bar -->
  <div class="filter-section">
    <div class="filter-title">Browse by category</div>
    <div class="filter-bar" id="filterBar">
      <button class="filter-pill active" data-filter="all">‚ú¶ All</button>
      <button class="filter-pill" data-filter="happy">üéâ Happy</button>
      <button class="filter-pill" data-filter="sad">üòî Sad</button>
      <button class="filter-pill" data-filter="angry">üò° Angry</button>
      <button class="filter-pill" data-filter="love">üíñ Love</button>
      <button class="filter-pill" data-filter="naughty">üî• Naughty</button>
      <button class="filter-pill" data-filter="confession">ü§´ Confession</button>
      <button class="filter-pill" data-filter="rant">üí¢ Rant</button>
      <button class="filter-pill" data-filter="advice">üí° Advice</button>
      <button class="filter-pill" data-filter="gratitude">üôè Gratitude</button>
      <button class="filter-pill" data-filter="random">üé≤ Random</button>
    </div>
  </div>

  <!-- Feed -->
  <div class="feed-hdr">
    <span class="feed-label" id="feedLabel">Community Feed</span>
    <div class="sort-group">
      <button class="sort-btn active" data-sort="newest">Newest</button>
      <button class="sort-btn" data-sort="popular">Popular</button>
    </div>
  </div>
  <div id="feed" class="feed" role="list"></div>
  <div id="emptyState" class="empty-state hidden">
    <div class="empty-icon">üí¨</div>
    <p>Nothing here yet ‚Äî be the first to post!</p>
  </div>

</main>

<footer class="site-footer">
  <div class="container">
    <p><span>GprinceDev RealTalk</span> &middot; Be kind. Be real. Stay anonymous.</p>
  </div>
</footer>
<div id="toast" class="toast" role="status" aria-live="polite"></div>

<!-- Firebase SDK -->
<script type="module">
/* ================================================================
   ‚ñº‚ñº‚ñº  PASTE YOUR FIREBASE CONFIG HERE  ‚ñº‚ñº‚ñº
   Get it from: Firebase Console ‚Üí Project Settings ‚Üí Your Apps
================================================================ */
const FIREBASE_CONFIG = {
  apiKey:            "AIzaSyAKdqT119DtM7IDqu01iUUM5HVdq8TTs_k",
  authDomain:        "whisperzone-b823d.firebaseapp.com",
  projectId:         "whisperzone-b823d",
  storageBucket:     "whisperzone-b823d.firebasestorage.app",
  messagingSenderId: "231174762136",
  appId:             "1:231174762136:web:f097bc57abbc671b53aaed"
};
/* ================================================================
   ‚ñ≤‚ñ≤‚ñ≤  END OF CONFIG  ‚ñ≤‚ñ≤‚ñ≤
================================================================ */

import { initializeApp }                          from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
import { getFirestore, collection, addDoc,
         onSnapshot, doc, updateDoc,
         serverTimestamp, query, orderBy,
         limit }                                  from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';

/* ‚îÄ‚îÄ DETECT if config is still default ‚îÄ‚îÄ */
const FIREBASE_READY = FIREBASE_CONFIG.apiKey !== 'YOUR_API_KEY';

/* ‚îÄ‚îÄ CONSTANTS ‚îÄ‚îÄ */
const NAME_KEY = 'realtalk_alias';
const RXNS_KEY = 'realtalk_reactions'; // local record of reacted post IDs

const CATEGORIES = {
  happy:{emoji:'üéâ',label:'Happy',initials:'HP'},sad:{emoji:'üòî',label:'Sad',initials:'SD'},
  angry:{emoji:'üò°',label:'Angry',initials:'ANG'},love:{emoji:'üíñ',label:'Love',initials:'LV'},
  naughty:{emoji:'üî•',label:'Naughty',initials:'NTY'},confession:{emoji:'ü§´',label:'Confession',initials:'CNF'},
  rant:{emoji:'üí¢',label:'Rant',initials:'RNT'},advice:{emoji:'üí°',label:'Advice',initials:'ADV'},
  gratitude:{emoji:'üôè',label:'Gratitude',initials:'GRT'},random:{emoji:'üé≤',label:'Random',initials:'RND'},
};

const PROMPTS = [
  "What's something on your mind today?","What's a secret you've never said out loud?",
  "What are you quietly proud of this week?","What would you do if nobody was watching?",
  "What's the most honest thing you can say right now?","What's weighing on you that no one knows about?",
  "What made you feel something real recently?","What do you need to hear right now?",
  "What's a thought you'd only share anonymously?","What's something you're afraid to admit out loud?",
  "What would you tell your past self right now?","What's a small win you haven't celebrated yet?",
  "What are you looking forward to, even if it's tiny?","What's something you're grateful for but never say?",
];

/* Fallback seed posts for local mode */
const SEED_LOCAL = [
  {id:'s1',cat:'confession',alias:'SilentNova',timestamp:Date.now()-5400000,text:"I pretended to have plans this weekend just so I could stay home alone. I don't regret it.",reactions:{relate:54,support:22,fire:31}},
  {id:'s2',cat:'naughty',alias:'CrimsonEcho',timestamp:Date.now()-10800000,text:"I've been flirting with my coworker for three months and neither of us has said anything. The tension is absolutely unreal.",reactions:{relate:88,support:14,fire:67}},
  {id:'s3',cat:'advice',alias:'LunarSage',timestamp:Date.now()-129600000,text:"Stop waiting until you 'feel ready'. You will never feel ready. Do the thing scared.",reactions:{relate:91,support:63,fire:55}},
  {id:'s4',cat:'sad',alias:'',timestamp:Date.now()-172800000,text:"Sometimes I feel like I'm disappearing slowly and nobody around me notices.",reactions:{relate:129,support:97,fire:11}},
];

/* ‚îÄ‚îÄ STATE ‚îÄ‚îÄ */
let posts       = [];       // used only in local/fallback mode
let activeSort  = 'newest';
let activeFilter= 'all';
let selectedCat = 'happy';
let db          = null;
let unsubscribe = null;
let isFirebase  = false;
let myReactions = {};       // postId ‚Üí ['relate','fire',...]

/* ‚îÄ‚îÄ DOM ‚îÄ‚îÄ */
const feedEl         = document.getElementById('feed');
const emptyEl        = document.getElementById('emptyState');
const inputEl        = document.getElementById('postInput');
const postBtn        = document.getElementById('postBtn');
const charEl         = document.getElementById('charCount');
const promptEl       = document.getElementById('promptText');
const toastEl        = document.getElementById('toast');
const catPillsEl     = document.getElementById('catPills');
const filterBarEl    = document.getElementById('filterBar');
const sortBtns       = document.querySelectorAll('.sort-btn');
const feedLabel      = document.getElementById('feedLabel');
const nameInput      = document.getElementById('nameInput');
const btnGenName     = document.getElementById('btnGenName');
const nameSavedBadge = document.getElementById('nameSavedBadge');
const loadingOverlay = document.getElementById('loadingOverlay');
const setupBanner    = document.getElementById('setupBanner');
const connStatus     = document.getElementById('connStatus');
const connText       = document.getElementById('connText');

/* ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ */
function uid(){ return Date.now()+'_'+Math.random().toString(36).slice(2,7) }

function ago(ts){
  if(!ts) return 'just now';
  const ms = ts.toMillis ? ts.toMillis() : ts;
  const d=Date.now()-ms,m=Math.floor(d/60000),h=Math.floor(d/3600000),dy=Math.floor(d/86400000);
  if(m<1) return 'just now'; if(m<60) return m+'m ago';
  if(h<24) return h+'h ago'; if(dy<7) return dy+'d ago';
  return new Date(ms).toLocaleDateString('en-US',{month:'short',day:'numeric'});
}

function esc(s){ const d=document.createElement('div');d.textContent=s;return d.innerHTML }

let _tt;
function showToast(msg,emoji=''){
  toastEl.textContent=(emoji?emoji+' ':'')+msg; toastEl.classList.add('show');
  clearTimeout(_tt); _tt=setTimeout(()=>toastEl.classList.remove('show'),2500);
}

function setConnStatus(online){
  connStatus.className='conn-status '+(online?'online':'offline');
  connText.textContent=online?'live':'offline';
}

/* ‚îÄ‚îÄ NAME GENERATOR ‚îÄ‚îÄ */
const ADJS =['Silent','Shadow','Ghost','Neon','Cosmic','Velvet','Hollow','Crimson','Mystic','Rogue','Lunar','Storm','Frozen','Crystal','Wild','Blazing','Serene','Iron','Secret','Broken','Vivid','Lone','Azure','Amber','Silver','Obsidian','Scarlet','Golden','Electric','Midnight'];
const NOUNS=['Wolf','Phoenix','Echo','Cipher','Spark','Drift','Nova','Specter','Viper','Raven','Comet','Pulse','Wraith','Ember','Tide','Flux','Mirage','Blaze','Frost','Tempest','Wisp','Oracle','Arrow','Prism','Crow','Sage','Shade','Flare','Bloom','Surge'];
function generateName(){ return ADJS[Math.floor(Math.random()*ADJS.length)]+NOUNS[Math.floor(Math.random()*NOUNS.length)] }
function getInitials(alias){ if(!alias) return '?'; const parts=alias.replace(/([a-z])([A-Z])/g,'$1 $2').split(/\s+/); if(parts.length>=2) return (parts[0][0]+parts[1][0]).toUpperCase(); return alias.slice(0,2).toUpperCase() }

/* name save/load */
let _nst;
function flashSaved(){ nameSavedBadge.classList.add('show'); setTimeout(()=>nameSavedBadge.classList.remove('show'),1800) }
function saveName(n){ try{localStorage.setItem(NAME_KEY,n)}catch(e){} }
function loadName(){ try{return localStorage.getItem(NAME_KEY)||''}catch(e){return ''} }

/* reactions local store */
function loadMyReactions(){ try{ return JSON.parse(localStorage.getItem(RXNS_KEY)||'{}') }catch(e){ return {} } }
function saveMyReactions(){ try{localStorage.setItem(RXNS_KEY,JSON.stringify(myReactions))}catch(e){} }

nameInput.addEventListener('input',()=>{ clearTimeout(_nst); _nst=setTimeout(()=>{ saveName(nameInput.value.trim()); flashSaved() },800) });
btnGenName.addEventListener('click',()=>{ const n=generateName(); nameInput.value=n; saveName(n); flashSaved(); nameInput.focus() });

/* ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ */
function getLocalFiltered(){
  let list = activeFilter==='all' ? [...posts] : posts.filter(p=>p.cat===activeFilter);
  return list.sort((a,b)=>{
    if(activeSort==='popular'){ const sa=(a.reactions.relate||0)+(a.reactions.support||0)+(a.reactions.fire||0),sb=(b.reactions.relate||0)+(b.reactions.support||0)+(b.reactions.fire||0); return sb-sa||b.timestamp-a.timestamp }
    return b.timestamp-a.timestamp;
  });
}

/* Full re-render for local/fallback mode */
function renderFeedLocal(){
  feedEl.innerHTML='';
  const list=getLocalFiltered();
  const cat=CATEGORIES[activeFilter];
  feedLabel.textContent=cat?cat.emoji+' '+cat.label+' Posts':'Community Feed';
  if(!list.length){ emptyEl.classList.remove('hidden'); return }
  emptyEl.classList.add('hidden');
  list.forEach((p,i)=>{ const c=buildCard(p,false); c.style.animationDelay=(i*.04)+'s'; feedEl.appendChild(c) });
}

/* For Firebase mode: prepend a single new card at the top */
function prependCard(p){
  emptyEl.classList.add('hidden');
  const cat=CATEGORIES[activeFilter];
  feedLabel.textContent=cat?cat.emoji+' '+cat.label+' Posts':'Community Feed';
  // respect filter
  if(activeFilter!=='all' && p.cat!==activeFilter) return;
  const card=buildCard(p,true);
  feedEl.insertBefore(card,feedEl.firstChild);
}

/* Update reaction counts on an existing card */
function updateCardReactions(postId,reactions){
  const card=feedEl.querySelector(`[data-id="${postId}"]`);
  if(!card) return;
  ['relate','support','fire'].forEach(type=>{
    const btn=card.querySelector(`[data-rxn="${type}"]`);
    if(btn) btn.querySelector('.rxn-count').textContent=reactions[type]||0;
  });
}

function buildCard(p, isNew=false){
  const cat=CATEGORIES[p.cat]||CATEGORIES.random;
  const reactions=p.reactions||{relate:0,support:0,fire:0};
  const rc=reactions.relate||0, sc=reactions.support||0, fc=reactions.fire||0;
  const myR=myReactions[p.id]||[];
  const rd=myR.includes('relate'), sd=myR.includes('support'), fd=myR.includes('fire');

  const art=document.createElement('article');
  art.className='post-card'; art.dataset.cat=p.cat; art.dataset.id=p.id; art.setAttribute('role','listitem');

  art.innerHTML=`
    <div class="card-top">
      <div class="card-meta">
        <div class="avatar" data-cat="${p.cat}">${getInitials(p.alias)}</div>
        <span class="${p.alias?'card-alias':'card-alias-anon'}">${esc(p.alias||'Anonymous')}</span>
        <span class="post-tag" data-cat="${p.cat}">${cat.emoji} ${cat.label}</span>
        ${isNew?'<span class="new-badge">‚ú¶ new</span>':''}
      </div>
      <time class="card-time">${ago(p.timestamp)}</time>
    </div>
    <p class="card-body">${esc(p.text)}</p>
    <div class="card-reactions">
      <button class="rxn-btn ${rd?'active-relate':''}" data-rxn="relate" aria-pressed="${rd}">
        <span class="rxn-icon">‚ù§Ô∏è</span><span>Relate</span><span class="rxn-count">${rc}</span>
      </button>
      <button class="rxn-btn ${sd?'active-support':''}" data-rxn="support" aria-pressed="${sd}">
        <span class="rxn-icon">ü§ù</span><span>Support</span><span class="rxn-count">${sc}</span>
      </button>
      <button class="rxn-btn ${fd?'active-fire':''}" data-rxn="fire" aria-pressed="${fd}">
        <span class="rxn-icon">üî•</span><span>Fire</span><span class="rxn-count">${fc}</span>
      </button>
    </div>`;

  art.querySelectorAll('.rxn-btn').forEach(btn=>btn.addEventListener('click',()=>handleReact(p.id,btn.dataset.rxn,btn)));
  return art;
}

/* ‚îÄ‚îÄ FIREBASE REAL-TIME LISTENER ‚îÄ‚îÄ */
function startFirebaseFeed(){
  const postsRef = collection(db,'posts');
  const q = query(postsRef, orderBy('timestamp','desc'), limit(100));

  // Track whether first snapshot has been processed
  let firstLoad = true;

  unsubscribe = onSnapshot(q, (snapshot)=>{
    setConnStatus(true);

    if(firstLoad){
      // Initial full render
      feedEl.innerHTML='';
      const cat=CATEGORIES[activeFilter];
      feedLabel.textContent=cat?cat.emoji+' '+cat.label+' Posts':'Community Feed';

      const docs=[];
      snapshot.forEach(d=>docs.push({id:d.id,...d.data()}));
      const filtered = activeFilter==='all' ? docs : docs.filter(p=>p.cat===activeFilter);
      const sorted   = sortDocs(filtered);

      if(!sorted.length){ emptyEl.classList.remove('hidden') }
      else {
        emptyEl.classList.add('hidden');
        sorted.forEach((p,i)=>{ const c=buildCard(p,false); c.style.animationDelay=(i*.04)+'s'; feedEl.appendChild(c) });
      }
      firstLoad=false;

      // Hide loading overlay
      loadingOverlay.classList.add('hidden');
      return;
    }

    // Incremental updates
    snapshot.docChanges().forEach(change=>{
      const p={id:change.doc.id,...change.doc.data()};
      if(change.type==='added'){
        prependCard(p);
      } else if(change.type==='modified'){
        updateCardReactions(p.id, p.reactions||{});
      } else if(change.type==='removed'){
        const card=feedEl.querySelector(`[data-id="${p.id}"]`);
        if(card) card.remove();
      }
    });
  }, (error)=>{
    console.error('Firestore error:',error);
    setConnStatus(false);
    showToast('Connection issue ‚Äî retrying‚Ä¶');
    loadingOverlay.classList.add('hidden');
  });
}

function sortDocs(docs){
  return docs.sort((a,b)=>{
    if(activeSort==='popular'){
      const sa=(a.reactions?.relate||0)+(a.reactions?.support||0)+(a.reactions?.fire||0);
      const sb=(b.reactions?.relate||0)+(b.reactions?.support||0)+(b.reactions?.fire||0);
      return sb-sa;
    }
    const ta=a.timestamp?.toMillis?a.timestamp.toMillis():a.timestamp||0;
    const tb=b.timestamp?.toMillis?b.timestamp.toMillis():b.timestamp||0;
    return tb-ta;
  });
}

/* ‚îÄ‚îÄ CREATE POST ‚îÄ‚îÄ */
async function createPost(){
  const text=inputEl.value.trim();
  if(!text){ showToast('Write something first ‚úèÔ∏è'); inputEl.focus(); return }

  postBtn.disabled=true;

  const alias=nameInput.value.trim()||'';
  const postData={ text, cat:selectedCat, alias, reactions:{relate:0,support:0,fire:0} };

  if(isFirebase){
    try{
      postData.timestamp=serverTimestamp();
      await addDoc(collection(db,'posts'),postData);
      inputEl.value=''; charEl.textContent='0 / 300'; charEl.className='char-count';
      showToast('Posted to everyone in real-time! üéâ');
      feedEl.scrollIntoView({behavior:'smooth',block:'start'});
    } catch(e){
      console.error(e);
      showToast('Error posting. Try again.');
    }
  } else {
    // local fallback
    postData.id=uid(); postData.timestamp=Date.now();
    posts.unshift(postData);
    inputEl.value=''; charEl.textContent='0 / 300'; charEl.className='char-count';
    renderFeedLocal();
    showToast('Posted locally (Firebase not connected)');
    feedEl.scrollIntoView({behavior:'smooth',block:'start'});
  }

  postBtn.disabled=false;
}

/* ‚îÄ‚îÄ REACTIONS ‚îÄ‚îÄ */
async function handleReact(postId, type, btn){
  const myR=myReactions[postId]||[];
  const already=myR.includes(type);

  // Optimistic UI update
  const countEl=btn.querySelector('.rxn-count');
  let count=parseInt(countEl.textContent)||0;
  if(already){
    count=Math.max(0,count-1);
    myReactions[postId]=myR.filter(r=>r!==type);
    btn.classList.remove('active-'+type);
    btn.setAttribute('aria-pressed','false');
  } else {
    count++;
    myReactions[postId]=[...myR,type];
    btn.classList.add('active-'+type);
    btn.setAttribute('aria-pressed','true');
  }
  countEl.textContent=count;
  saveMyReactions();
  countEl.classList.remove('bump'); void countEl.offsetWidth; countEl.classList.add('bump');

  if(isFirebase){
    try{
      const postRef=doc(db,'posts',postId);
      // get all current reaction counts from DOM
      const card=feedEl.querySelector(`[data-id="${postId}"]`);
      const newReactions={};
      ['relate','support','fire'].forEach(t=>{
        const b=card?.querySelector(`[data-rxn="${t}"] .rxn-count`);
        newReactions[t]=b?parseInt(b.textContent)||0:0;
      });
      await updateDoc(postRef,{reactions:newReactions});
    } catch(e){
      console.error('Reaction update failed:',e);
    }
  } else {
    const p=posts.find(x=>x.id===postId);
    if(p){
      if(already) p.reactions[type]=Math.max(0,p.reactions[type]-1);
      else p.reactions[type]++;
    }
  }
}

/* ‚îÄ‚îÄ EVENTS ‚îÄ‚îÄ */
inputEl.addEventListener('input',()=>{
  const n=inputEl.value.length; charEl.textContent=n+' / 300';
  charEl.className='char-count'+(n>=280?' danger':n>=240?' warn':'');
});
postBtn.addEventListener('click',createPost);
inputEl.addEventListener('keydown',e=>{ if((e.ctrlKey||e.metaKey)&&e.key==='Enter') createPost() });

catPillsEl.addEventListener('click',e=>{
  const pill=e.target.closest('.cat-pill'); if(!pill) return;
  document.querySelectorAll('.cat-pill').forEach(p=>p.classList.remove('selected'));
  pill.classList.add('selected'); selectedCat=pill.dataset.cat;
});

filterBarEl.addEventListener('click',e=>{
  const pill=e.target.closest('.filter-pill'); if(!pill) return;
  document.querySelectorAll('.filter-pill').forEach(p=>p.classList.remove('active'));
  pill.classList.add('active'); activeFilter=pill.dataset.filter;
  if(isFirebase){ startFirebaseFeed() } else { renderFeedLocal() }
});

sortBtns.forEach(btn=>btn.addEventListener('click',()=>{
  activeSort=btn.dataset.sort;
  sortBtns.forEach(b=>b.classList.remove('active')); btn.classList.add('active');
  if(isFirebase){ startFirebaseFeed() } else { renderFeedLocal() }
}));

/* ‚îÄ‚îÄ INIT ‚îÄ‚îÄ */
(function init(){
  // Daily prompt
  const doy=Math.floor((Date.now()-new Date(new Date().getFullYear(),0,0))/86400000);
  promptEl.textContent=PROMPTS[doy%PROMPTS.length];

  // Restore alias & reactions
  const saved=loadName(); if(saved) nameInput.value=saved;
  myReactions=loadMyReactions();

  if(FIREBASE_READY){
    // Init Firebase + Firestore
    try{
      const app=initializeApp(FIREBASE_CONFIG);
      db=getFirestore(app);
      isFirebase=true;
      setConnStatus(true);
      setupBanner.classList.remove('show');
      startFirebaseFeed();
      // Hide loader after 4s max
      setTimeout(()=>loadingOverlay.classList.add('hidden'),4000);
    } catch(e){
      console.error('Firebase init failed:',e);
      fallbackToLocal();
    }
  } else {
    fallbackToLocal();
  }
})();

function fallbackToLocal(){
  isFirebase=false;
  setConnStatus(false);
  setupBanner.classList.add('show');
  posts=SEED_LOCAL;
  loadingOverlay.classList.add('hidden');
  renderFeedLocal();
}
</script>
</body>
</html>
